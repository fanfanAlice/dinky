(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{ObQG:function(C,P,t){C.exports={container:"container___1sYa-",lang:"lang___l6cji",content:"content___2zk1-",top:"top___1C1Zi",header:"header___5xZ3f",logo:"logo___2hXsy",title:"title___1-xuF",desc:"desc___-njyT",main:"main___x4OjT",icon:"icon___rzGKO",other:"other___lLyaU",register:"register___11Twg",prefixIcon:"prefixIcon___23Xrx"}},PdsH:function(C,P,t){"use strict";t.r(P);var Pe=t("2qtc"),J=t("kLXV"),De=t("+L6B"),I=t("2/Rp"),Me=t("miYZ"),v=t("tsqr"),u=t("qLMh"),g=t("k1fw"),E=t("9og8"),d=t("tJVT"),Y=t("cJ7L"),Z=t("FY4R"),l=t("q1tI"),Te=t.n(l),H=t("VMEa"),L=t("Qurx"),Q=t("tneF"),f=t("9kvl"),q=t("uYtH"),ee=t("CwrG"),te=t("74pX"),S=t("zv96"),ae=t("ObQG"),c=t.n(ae),U=t("kZX9"),_=t("HOj0"),ne=t("p46w"),se=t.n(ne),a=t("nKUr"),Ce=t.n(a),re=function(){!f.e||setTimeout(function(){var D=f.e.location.query,h=D,p=h.redirect;f.e.push(p||"/")},10)},_e=function(){var D=Object(l.useState)(!1),h=Object(d.a)(D,2),p=h[0],B=h[1],oe=Object(l.useState)({}),R=Object(d.a)(oe,2),Ie=R[0],le=R[1],ce=Object(l.useState)({}),K=Object(d.a)(ce,2),j=K[0],x=K[1],ue=Object(l.useState)("password"),y=Object(d.a)(ue,2),A=y[0],de=y[1],W=Object(f.k)("@@initialState"),m=W.initialState,Oe=W.setInitialState,je=Object(l.useState)(!0),k=Object(d.a)(je,2),me=k[0],w=k[1],be=Object(l.useState)(!1),N=Object(d.a)(be,2),ve=N[0],M=N[1],ge=Object(l.useState)([]),F=Object(d.a)(ge,2),T=F[0],z=F[1],Ee=Object(l.useState)(!0),G=Object(d.a)(Ee,2),fe=G[0],V=G[1],he=function(){var o=Object(E.a)(Object(u.a)().mark(function e(){var s,r;return Object(u.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m==null||(s=m.fetchUserInfo)===null||s===void 0?void 0:s.call(m);case 2:r=n.sent,r&&Oe(Object(g.a)(Object(g.a)({},m),{},{currentUser:r}));case 4:case"end":return n.stop()}},e)}));return function(){return o.apply(this,arguments)}}();Object(l.useEffect)(function(){var o=j.username;!o||Object(U.c)("/api/geTenants",{username:o}).then(function(e){z(e==null?void 0:e.datas)})},[j==null?void 0:j.username]);var X=function(e){localStorage.setItem("dlink-tenantId",e.toString()),se.a.set("tenantId",e.toString(),{path:"/"})},$=function(){var o=Object(E.a)(Object(u.a)().mark(function e(s){var r;return Object(u.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(me){n.next=2;break}return n.abrupt("return");case 2:return w(!1),setTimeout(function(){w(!0)},200),B(!0),n.prev=5,n.next=8,Object(te.b)(Object(g.a)(Object(g.a)({},s),{},{type:A}));case 8:if(r=n.sent,!(r.code===0&&r.datas!=null)){n.next=17;break}return v.default.success(Object(_.a)("pages.login.success")),n.next=13,he();case 13:return re(),n.abrupt("return");case 17:v.default.error(Object(_.a)(r.msg,r.msg));case 18:le(r.datas),n.next=24;break;case 21:n.prev=21,n.t0=n.catch(5),v.default.error(Object(_.a)("pages.login.failure"));case 24:B(!1);case 25:case"end":return n.stop()}},e,null,[[5,21]])}));return function(s){return o.apply(this,arguments)}}(),pe=function(){return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(J.a,{title:Object(_.a)("pages.login.chooseTenant"),visible:ve,destroyOnClose:!0,width:"60%",onCancel:function(){M(!1)},footer:[Object(a.jsx)(I.a,{onClick:function(){M(!1)},children:Object(_.a)("button.close")},"back"),Object(a.jsx)(I.a,{disabled:fe,type:"primary",loading:p,onClick:Object(E.a)(Object(u.a)().mark(function e(){return Object(u.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,$(j);case 2:case"end":return r.stop()}},e)})),children:Object(_.a)("button.confirm")},"submit")],children:Object(a.jsx)(S.a.Group,{multiple:!1,onChange:function(s){s?(V(!1),j.tenantId=s,X(s)):V(!0)},children:T==null?void 0:T.map(function(e){return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(S.a,{size:"default",avatar:"/icons/tenant_default.svg",title:e==null?void 0:e.tenantCode,value:e==null?void 0:e.id,description:e==null?void 0:e.note},e==null?void 0:e.id)})})})})})};return Object(a.jsxs)("div",{className:c.a.container,children:[Object(a.jsxs)("div",{className:c.a.content,children:[Object(a.jsxs)("div",{className:c.a.top,children:[Object(a.jsx)("div",{className:c.a.header,children:Object(a.jsx)(q.a,{to:"/",children:Object(a.jsx)("img",{alt:"logo",className:c.a.logo,src:"/kylin1.png"})})}),Object(a.jsx)("div",{className:c.a.desc,children:Object(_.a)("pages.layouts.userLayout.title")})]}),Object(a.jsx)("div",{className:c.a.main,children:Object(a.jsxs)(H.a,{initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:Object(_.a)("pages.login.submit")},render:function(e,s){return s.pop()},submitButtonProps:{loading:p,size:"large",style:{width:"100%"},htmlType:"submit"}},onFinish:function(){var o=Object(E.a)(Object(u.a)().mark(function e(s){var r,b;return Object(u.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return de("password"),O.next=3,Object(U.c)("/api/geTenants",{username:s.username}).then(function(i){if(!(i!=null&&i.datas)){v.default.error(i==null?void 0:i.msg);return}return z(i==null?void 0:i.datas),i==null?void 0:i.datas});case 3:if(r=O.sent,r.length!==1){O.next=13;break}return b=r.pop().id,s.tenantId=b,X(b),x(s),O.next=11,$(s);case 11:O.next=15;break;case 13:x(s),M(!0);case 15:case"end":return O.stop()}},e)}));return function(e){return o.apply(this,arguments)}}(),children:[A==="password"&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(L.a,{name:"username",fieldProps:{size:"large",prefix:Object(a.jsx)(Y.a,{className:c.a.prefixIcon})},placeholder:Object(_.a)("pages.login.username.placeholder"),rules:[{required:!0,message:Object(_.a)("pages.login.username.required")}]}),Object(a.jsx)(L.a.Password,{name:"password",fieldProps:{size:"large",prefix:Object(a.jsx)(Z.a,{className:c.a.prefixIcon})},placeholder:Object(_.a)("pages.login.password.placeholder"),rules:[{required:!0,message:Object(_.a)("pages.login.password.required")}]})]}),Object(a.jsxs)("div",{style:{marginBottom:24},children:[Object(a.jsx)(Q.a,{noStyle:!0,name:"autoLogin",children:Object(_.a)("pages.login.rememberMe")}),Object(a.jsx)("a",{style:{float:"right"},children:Object(_.a)("pages.login.forgotPassword")})]})]})})]}),Object(a.jsx)(ee.a,{}),pe()]})};P.default=_e}}]);
